
# 高性能本地上传服务简介

## 📋 核心功能概述

本地上传服务是整个高性能文件上传系统的核心组件，作为独立进程运行，负责接收客户端通知并执行真实的文件上传操作。

## 🏗️ 服务架构

服务进程中包含以下核心线程：

### 1. Socket监听线程
- **职责**: 专门启用一个本地socket监听上传通知
- **功能**: 接收客户端通知，反序列化数据结构体并添加到上传队列
- **特点**: 这个队列是全局的，支持高并发访问

### 2. 上传管理线程
- **主要任务**:
  1. **读取任务**: 读取需要上传的文件信息队列
  2. **线程管理**: 维护上传线程引用计数，保证启动目标数量的上传线程进行数据上传
- **调度策略**: 上传结束一个启动一个，以此类推，保持稳定的并发数

### 3. 上传工作线程池
- **功能**: 执行真实的HTTP文件上传
- **特点**: 可配置并发数，支持断点续传和重试机制

### 4. 进度回调线程
- **功能**: 定时收集上传进度，通过Socket发送给UI进程
- **频率**: 每秒回调一次，确保实时性

## 🔌 进程间通信

### UI进程监听
- **目的**: UI进程上启用一个socket监听，用于接收进度回调或者发送状态等
- **通信方式**: 双向Socket通信，支持进度推送和状态查询

## 🎯 设计优势

1. **🏢 进程隔离**: 独立进程运行，不影响UI响应
2. **🧵 多线程并发**: 支持可配置的并发上传数量
3. **📊 队列缓冲**: 全局队列支持高并发文件入队
4. **⚡ 实时反馈**: 及时的进度回调和状态更新
5. **🛡️ 稳定可靠**: 线程异常自动恢复，支持长期运行

## �️ Windows服务支持

本地上传服务支持以**Windows服务**方式运行，提供无人值守的后台上传能力：

### 服务特性
- 🔄 **系统启动自动运行**：无需用户登录即可提供服务
- 🛡️ **后台稳定运行**：不受用户会话影响
- 📊 **系统日志集成**：完善的Windows事件日志记录
- ⚡ **自动故障恢复**：服务异常时自动重启
- 🔒 **安全权限隔离**：以系统账户安全运行

### 快速部署
1. **图形化管理**：双击运行 `ServiceManager.bat`
2. **命令行管理**：使用 `Deploy-UploadService.ps1` 脚本
3. **手动安装**：`UploadService.exe install`

### 服务管理命令
```cmd
# 安装服务（需管理员权限）
UploadService.exe install

# 启动服务
net start HighPerformanceUploadService

# 停止服务
net stop HighPerformanceUploadService

# 卸载服务
UploadService.exe uninstall
```

## �📖 详细文档

完整的架构设计和代码实现请参考：[LocalUploadService_Architecture.md](./LocalUploadService_Architecture.md)